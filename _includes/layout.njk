<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ title or site.title }}</title>

    <link rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap&subset=cyrillic,cyrillic-ext,latin">
    <link rel="stylesheet" href="/assets/style.css">
    <link rel="stylesheet" href="/assets/pagefind/pagefind-ui.css">
    <script src="/assets/pagefind/pagefind-ui.js"></script>
  </head>
  <body>
    <header class="container">
  <div class="site-header" data-pagefind-ignore>
    <div class="site-header__logo">
      <a href="/" aria-label="На главную">
        <img src="/assets/logo.png" alt="PHG" height="150">
      </a>
    </div>

    <div class="site-header__title">
      <div class="site-title"><a href="/">{{ site.title }}</a></div>
      <div class="tagline">{{ site.tagline }}</div>
    </div>

    <div class="site-header__search">
      <div id="search" class="search"></div>
    </div>
  </div>
      <nav class="chapters-horizontal">
        <ul>
          <li class="menu-group">
            <span>Введения</span>
            <ul class="submenu">
              <li><a href="/intro1">К изданию 1994 г.</a></li>
              <li><a href="/intro2">К изданию 1951 г.</a></li>
            </ul>
          </li>

          <li class="menu-group">
            <span>Том 1</span>
            <ul class="submenu">
              {% if collections.chaptersByVolume and collections.chaptersByVolume[1] %}
                {% for ch in collections.chaptersByVolume[1] %}
                  <li><a href="{{ ch.url }}">{{ ch.data.menuTitle or ch.data.title or ch.fileSlug }}</a></li>
                {% endfor %}
              {% else %}
                <li><em>Пока нет глав</em></li>
              {% endif %}
            </ul>
          </li>

          <li class="menu-group">
            <span>Том 2</span>
            <ul class="submenu">
              {% if collections.chaptersByVolume and collections.chaptersByVolume[2] %}
                {% for ch in collections.chaptersByVolume[2] %}
                  <li><a href="{{ ch.url }}">{{ ch.data.menuTitle or ch.data.title or ch.fileSlug }}</a></li>
                {% endfor %}
              {% else %}
                <li><em>Пока нет глав</em></li>
              {% endif %}
            </ul>
          </li>

          <li class="menu-group">
            <span>Материалы</span>
            <ul class="submenu">
              <li><a href="/glossary">Глоссарий</a></li>
              <li><a href="/about">О проекте</a></li>
              <li><a href="/gttl">GTTL</a></li>
            </ul>
          </li>
        </ul>
      </nav>
      
    </header>

    <main class="container content" data-pagefind-body>
      {# =========================
   AUTO PREV / NEXT (ТОЛЬКО ДЛЯ ГЛАВ)
   Требует в frontmatter:
     type: chapter
     volume: 1 или 2
   ========================= #}

{% set isChapter = (type == "chapter") %}
{% if isChapter and collections.chaptersByVolume and collections.chaptersByVolume[volume] %}
  {% set list = collections.chaptersByVolume[volume] %}
  {% set prev = null %}
  {% set next = null %}
  {% set last = null %}
  {% set found = false %}

  {# Ищем prev/next по совпадению URL #}
  {% for ch in list %}
    {% if not found %}
      {% if ch.url == page.url %}
        {% set prev = last %}
        {% set found = true %}
      {% else %}
        {% set last = ch %}
      {% endif %}
    {% else %}
      {% if not next %}
        {% set next = ch %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% if isChapter and found %}
<div class="parallel-nav-grid">
  <div class="nav-ru">
    {% if prev %}
      <a class="chapter-nav-link" href="{{ prev.url }}">← {{ prev.data.title }}</a>
    {% endif %}
  </div>

  <div class="nav-en">
    

    {% if next %}
      <a class="chapter-nav-link" href="{{ next.url }}">{{ next.data.title }} →</a>
    {% endif %}
  </div>
</div>
{% endif %}
{% endif %}
        {# Листалка сверху — “над серой областью” (контентом) #}
        {# {% if found %}
          <div class="parallel-nav-grid" data-parallel-nav>
  <div class="nav-ru">
    <!-- prev -->
  </div>

  <div class="nav-en">
  <!-- next -->
    <button class="parallel-toggle" type="button" data-parallel-toggle>Скрыть оригинал ×</button>
    
  </div>
</div>
        {% endif %} #}

      {# ====== ВАЖНО: КОНТЕНТ ВСЕГДА РЕНДЕРИТСЯ ====== #}
      {{ content | safe }}

      <hr>

      <section class="disclaimer" data-pagefind-ignore>
        <p>{{ site.disclaimer_en }}</p>
        <p>{{ site.disclaimer_ru }}</p>
      </section>

      <section class="comments">
        {# Giscus (если включишь — раскомментируешь и заполнишь атрибуты) #}
      </section>
    </main>

    <footer class="container footer" data-pagefind-ignore>
      <p>© GTTL Translators, 2025 · Research & Educational Use Only</p>
    </footer>

    <script async src="https://hypothes.is/embed.js"></script>

   <script>
document.addEventListener("DOMContentLoaded", function () {
  // 1) Переносим parallel-nav-grid внутрь .parallel-block (перед .parallel-controls)
  const nav = document.querySelector(".parallel-nav-grid");
  const block = document.querySelector(".parallel-block");

  if (nav && block) {
    const controls = block.querySelector(".parallel-controls");
    if (controls) {
      block.insertBefore(nav, controls);
    } else {
      block.prepend(nav);
    }
  }

  // 2) Тоггл скрытия оригинала (для каждого parallel-block)
  document.querySelectorAll(".parallel-block").forEach((block) => {
    const btn = block.querySelector("[data-parallel-toggle]");
    if (!btn) return;

    btn.addEventListener("click", () => {
      const closed = block.classList.toggle("parallel-closed");
      btn.textContent = closed ? "Показать оригинал" : "Скрыть оригинал ×";
    });
  });
});
</script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  if (!window.PagefindUI) return;
  new PagefindUI({
    element: "#search",
bundlePath: "/pagefind/",
    showSubResults: true,
    pageSize: 20
  });
});
</script>
  </body>
</html>
